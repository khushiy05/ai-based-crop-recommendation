import React, { useState, useRef, useEffect } from 'react';
import { Send, Mic, MicOff, Bot, User, Volume2 } from 'lucide-react';

interface ChatBotProps {
  selectedLanguage: string;
  isOnline: boolean;
}

interface Message {
  id: string;
  text: string;
  sender: 'user' | 'bot';
  timestamp: Date;
}

const ChatBot: React.FC<ChatBotProps> = ({ selectedLanguage, isOnline }) => {
  const [messages, setMessages] = useState<Message[]>([
    {
      id: '1',
      text: selectedLanguage === 'hi' 
        ? 'рдирдорд╕реНрддреЗ! рдореИрдВ рдЖрдкрдХрд╛ AI рдХреГрд╖рд┐ рд╕рд╣рд╛рдпрдХ рд╣реВрдВред рдореИрдВ рдЦреЗрддреА, рдлрд╕рд▓, рдмреАрдорд╛рд░реА рдирд┐рдпрдВрддреНрд░рдг рдФрд░ рдмрд╛рдЬрд╝рд╛рд░ рдХреА рдХреАрдорддреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЖрдкрдХреА рдорджрдж рдХрд░ рд╕рдХрддрд╛ рд╣реВрдВред'
        : 'Hello! I\'m your AI farming assistant. I can help you with farming tips, crop advice, disease control, and market prices.',
      sender: 'bot',
      timestamp: new Date()
    }
  ]);
  const [inputText, setInputText] = useState('');
  const [isRecording, setIsRecording] = useState(false);
  const [isTyping, setIsTyping] = useState(false);
  const messagesEndRef = useRef<HTMLDivElement>(null);

  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  };

  useEffect(() => {
    scrollToBottom();
  }, [messages]);

  const predefinedResponses = {
    en: {
      greeting: "Hello! How can I help you with your farming needs today?",
      rice: "Rice cultivation tips: Maintain 2-5cm water level, use 25-30 kg seeds per hectare, and apply NPK fertilizer in 3 splits. Harvest when 80% grains are golden yellow.",
      wheat: "Wheat farming advice: Sow during November-December, use 100-125 kg seeds per hectare, irrigate 4-6 times during growth period. Apply 120:60:40 NPK kg/hectare.",
      disease: "For disease identification, please use our Disease Detection feature by uploading a clear image of the affected plant part.",
      weather: "Weather information is integrated with our crop recommendations. Enable location services for accurate local weather data.",
      market: "Current market prices vary by region. Rice: тВ╣20-25/kg, Wheat: тВ╣22-28/kg, Tomato: тВ╣15-30/kg. Prices are updated daily when online.",
      default: "I can help with farming techniques, crop selection, pest control, irrigation, fertilizers, and market information. What specific topic interests you?"
    },
    hi: {
      greeting: "рдирдорд╕реНрддреЗ! рдЖрдЬ рдореИрдВ рдЖрдкрдХреА рдЦреЗрддреА рдХреА рдЬрд░реВрд░рддреЛрдВ рдореЗрдВ рдХреИрд╕реЗ рдорджрдж рдХрд░ рд╕рдХрддрд╛ рд╣реВрдВ?",
      rice: "рдЪрд╛рд╡рд▓ рдХреА рдЦреЗрддреА рдХреА рд╕рд▓рд╛рд╣: 2-5 рд╕реЗрдореА рдкрд╛рдиреА рдмрдирд╛рдП рд░рдЦреЗрдВ, рдкреНрд░рддрд┐ рд╣реЗрдХреНрдЯреЗрдпрд░ 25-30 рдХрд┐рд▓реЛ рдмреАрдЬ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ, рдФрд░ NPK рдЙрд░реНрд╡рд░рдХ рдХреЛ 3 рднрд╛рдЧреЛрдВ рдореЗрдВ рджреЗрдВред рдЬрдм 80% рджрд╛рдиреЗ рд╕реБрдирд╣рд░реЗ рд╣реЛ рдЬрд╛рдПрдВ рддреЛ рдХрдЯрд╛рдИ рдХрд░реЗрдВред",
      wheat: "рдЧреЗрд╣реВрдВ рдХреА рдЦреЗрддреА рдХреА рд╕рд▓рд╛рд╣: рдирд╡рдВрдмрд░-рджрд┐рд╕рдВрдмрд░ рдореЗрдВ рдмреБрдЖрдИ рдХрд░реЗрдВ, рдкреНрд░рддрд┐ рд╣реЗрдХреНрдЯреЗрдпрд░ 100-125 рдХрд┐рд▓реЛ рдмреАрдЬ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ, рд╡рд┐рдХрд╛рд╕ рдЕрд╡рдзрд┐ рдореЗрдВ 4-6 рдмрд╛рд░ рд╕рд┐рдВрдЪрд╛рдИ рдХрд░реЗрдВред 120:60:40 NPK рдХрд┐рд▓реЛ рдкреНрд░рддрд┐ рд╣реЗрдХреНрдЯреЗрдпрд░ рдбрд╛рд▓реЗрдВред",
      disease: "рдмреАрдорд╛рд░реА рдХреА рдкрд╣рдЪрд╛рди рдХреЗ рд▓рд┐рдП, рдХреГрдкрдпрд╛ рдкреНрд░рднрд╛рд╡рд┐рдд рдкреМрдзреЗ рдХреЗ рд╣рд┐рд╕реНрд╕реЗ рдХреА рд╕реНрдкрд╖реНрдЯ рддрд╕реНрд╡реАрд░ рдЕрдкрд▓реЛрдб рдХрд░рдХреЗ рд╣рдорд╛рд░реЗ рд░реЛрдЧ рдирд┐рджрд╛рди рдлреАрдЪрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред",
      weather: "рдореМрд╕рдо рдХреА рдЬрд╛рдирдХрд╛рд░реА рд╣рдорд╛рд░реА рдлрд╕рд▓ рд╕рд┐рдлрд╛рд░рд┐рд╢реЛрдВ рдХреЗ рд╕рд╛рде рдПрдХреАрдХреГрдд рд╣реИред рд╕рдЯреАрдХ рд╕реНрдерд╛рдиреАрдп рдореМрд╕рдо рдбреЗрдЯрд╛ рдХреЗ рд▓рд┐рдП рд╕реНрдерд╛рди рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рд╕рдХреНрд╖рдо рдХрд░реЗрдВред",
      market: "рд╡рд░реНрддрдорд╛рди рдмрд╛рдЬрд╛рд░ рдореВрд▓реНрдп рдХреНрд╖реЗрддреНрд░ рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдЕрд▓рдЧ-рдЕрд▓рдЧ рд╣реИрдВред рдЪрд╛рд╡рд▓: тВ╣20-25/рдХрд┐рд▓реЛ, рдЧреЗрд╣реВрдВ: тВ╣22-28/рдХрд┐рд▓реЛ, рдЯрдорд╛рдЯрд░: тВ╣15-30/рдХрд┐рд▓реЛред рдСрдирд▓рд╛рдЗрди рд╣реЛрдиреЗ рдкрд░ рдХреАрдорддреЗрдВ рджреИрдирд┐рдХ рдЕрдкрдбреЗрдЯ рд╣реЛрддреА рд╣реИрдВред",
      default: "рдореИрдВ рдЦреЗрддреА рдХреА рддрдХрдиреАрдХреЛрдВ, рдлрд╕рд▓ рдЪрдпрди, рдХреАрдЯ рдирд┐рдпрдВрддреНрд░рдг, рд╕рд┐рдВрдЪрд╛рдИ, рдЙрд░реНрд╡рд░рдХ рдФрд░ рдмрд╛рдЬрд╛рд░ рдХреА рдЬрд╛рдирдХрд╛рд░реА рдореЗрдВ рдорджрдж рдХрд░ рд╕рдХрддрд╛ рд╣реВрдВред рдЖрдкрдХреЛ рдХреМрди рд╕рд╛ рд╡рд┐рд╖рдп рджрд┐рд▓рдЪрд╕реНрдк рд▓рдЧрддрд╛ рд╣реИ?"
    },
    mr: {
      greeting: "рдирдорд╕реНрдХрд╛рд░! рдЖрдЬ рдореА рддреБрдордЪреНрдпрд╛ рд╢реЗрддреАрдЪреНрдпрд╛ рдЧрд░рдЬрд╛рдВрдордзреНрдпреЗ рдХрд╢реА рдорджрдд рдХрд░реВ рд╢рдХрддреЛ?",
      rice: "рддрд╛рдВрджрд│рд╛рдЪреНрдпрд╛ рд▓рд╛рдЧрд╡рдбреАрдЪреНрдпрд╛ рдЯрд┐рдкреНрд╕: 2-5 рд╕реЗрдореА рдкрд╛рдгреНрдпрд╛рдЪреА рдкрд╛рддрд│реА рд░рд╛рдЦрд╛, рдкреНрд░рддрд┐ рд╣реЗрдХреНрдЯрд░ 25-30 рдХрд┐рд▓реЛ рдмрд┐рдпрд╛рдгреЗ рд╡рд╛рдкрд░рд╛, рдЖрдгрд┐ NPK рдЦрдд 3 рднрд╛рдЧрд╛рдВрдд рджреНрдпрд╛ред 80% рджрд╛рдгреЗ рд╕реЛрдиреЗрд░реА рдЭрд╛рд▓реНрдпрд╛рд╡рд░ рдХрд╛рдкрдгреА рдХрд░рд╛.",
      wheat: "рдЧрд╡реНрд╣рд╛рдЪреНрдпрд╛ рд╢реЗрддреАрдЪрд╛ рд╕рд▓реНрд▓рд╛: рдиреЛрд╡реНрд╣реЗрдВрдмрд░-рдбрд┐рд╕реЗрдВрдмрд░рдордзреНрдпреЗ рдкреЗрд░рдгреА рдХрд░рд╛, рдкреНрд░рддрд┐ рд╣реЗрдХреНрдЯрд░ 100-125 рдХрд┐рд▓реЛ рдмрд┐рдпрд╛рдгреЗ рд╡рд╛рдкрд░рд╛, рд╡рд╛рдвреАрдЪреНрдпрд╛ рдХрд╛рд│рд╛рдд 4-6 рд╡реЗрд│рд╛ рдкрд╛рдгреА рджреНрдпрд╛ред 120:60:40 NPK рдХрд┐рд▓реЛ рдкреНрд░рддрд┐ рд╣реЗрдХреНрдЯрд░ рдЯрд╛рдХрд╛.",
      disease: "рд░реЛрдЧрд╛рдЪреНрдпрд╛ рдУрд│рдЦреАрд╕рд╛рдареА, рдХреГрдкрдпрд╛ рдкреНрд░рднрд╛рд╡рд┐рдд рдЭрд╛рдбрд╛рдЪреНрдпрд╛ рднрд╛рдЧрд╛рдЪрд╛ рд╕реНрдкрд╖реНрдЯ рдлреЛрдЯреЛ рдЕрдкрд▓реЛрдб рдХрд░реВрди рдЖрдордЪреЗ рд░реЛрдЧ рдирд┐рджрд╛рди рд╡реИрд╢рд┐рд╖реНрдЯреНрдп рд╡рд╛рдкрд░рд╛.",
      weather: "рд╣рд╡рд╛рдорд╛рдирд╛рдЪреА рдорд╛рд╣рд┐рддреА рдЖрдордЪреНрдпрд╛ рдкреАрдХ рд╢рд┐рдлрд╛рд░рд╢реАрдВрд╕рд╣ рдПрдХрддреНрд░рд┐рдд рдЖрд╣реЗ. рдЕрдЪреВрдХ рд╕реНрдерд╛рдирд┐рдХ рд╣рд╡рд╛рдорд╛рди рдбреЗрдЯрд╛рд╕рд╛рдареА рд╕реНрдерд╛рди рд╕реЗрд╡рд╛ рд╕рдХреНрд╖рдо рдХрд░рд╛.",
      market: "рд╕рдзреНрдпрд╛рдЪреНрдпрд╛ рдмрд╛рдЬрд╛рд░ рдХрд┐рдорддреА рдкреНрд░рджреЗрд╢рд╛рдиреБрд╕рд╛рд░ рдмрджрд▓рддрд╛рдд. рддрд╛рдВрджреВрд│: тВ╣20-25/рдХрд┐рд▓реЛ, рдЧрд╣реВ: тВ╣22-28/рдХрд┐рд▓реЛ, рдЯреЛрдореЕрдЯреЛ: тВ╣15-30/рдХрд┐рд▓реЛ. рдСрдирд▓рд╛рдЗрди рдЕрд╕рддрд╛рдирд╛ рдХрд┐рдорддреА рджрд░рд░реЛрдЬ рдЕрдкрдбреЗрдЯ рд╣реЛрддрд╛рдд.",
      default: "рдореА рд╢реЗрддреАрдЪреНрдпрд╛ рддрдВрддреНрд░рд╛рдВрдордзреНрдпреЗ, рдкреАрдХ рдирд┐рд╡рдб, рдХреАрдб рдирд┐рдпрдВрддреНрд░рдг, рд╕рд┐рдВрдЪрди, рдЦрддреЗ рдЖрдгрд┐ рдмрд╛рдЬрд╛рд░ рдорд╛рд╣рд┐рддреАрдордзреНрдпреЗ рдорджрдд рдХрд░реВ рд╢рдХрддреЛ. рддреБрдореНрд╣рд╛рд▓рд╛ рдХреЛрдгрддрд╛ рд╡рд┐рд╖рдп рдордиреЛрд░рдВрдЬрдХ рд╡рд╛рдЯрддреЛ?"
    },
    bn: {
      greeting: "ржиржорж╕рзНржХрж╛рж░! ржЖржЬ ржЖржорж┐ ржЖржкржирж╛рж░ ржХрзГрж╖рж┐ ржкрзНрж░ржпрж╝рзЛржЬржирзЗ ржХрзАржнрж╛ржмрзЗ рж╕рж╛рж╣рж╛ржпрзНржп ржХрж░рждрзЗ ржкрж╛рж░рж┐?",
      rice: "ржзрж╛ржи ржЪрж╛рж╖рзЗрж░ ржЯрж┐ржкрж╕: рзи-рзл рж╕рзЗржорж┐ ржкрж╛ржирж┐рж░ рж╕рзНрждрж░ ржмржЬрж╛ржпрж╝ рж░рж╛ржЦрзБржи, ржкрзНрж░рждрж┐ рж╣рзЗржХрзНржЯрж░рзЗ рзирзл-рзйрзж ржХрзЗржЬрж┐ ржмрзАржЬ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи, ржПржмржВ NPK рж╕рж╛рж░ рзй ржнрж╛ржЧрзЗ ржкрзНрж░ржпрж╝рзЛржЧ ржХрж░рзБржиред рзорзж% ржжрж╛ржирж╛ рж╕рзЛржирж╛рж▓рж┐ рж╣рж▓рзЗ ржХрж╛ржЯрзБржиред",
      wheat: "ржЧржо ржЪрж╛рж╖рзЗрж░ ржкрж░рж╛ржорж░рзНрж╢: ржиржнрзЗржорзНржмрж░-ржбрж┐рж╕рзЗржорзНржмрж░рзЗ ржмржкржи ржХрж░рзБржи, ржкрзНрж░рждрж┐ рж╣рзЗржХрзНржЯрж░рзЗ рззрзжрзж-рззрзирзл ржХрзЗржЬрж┐ ржмрзАржЬ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи, ржмрзГржжрзНржзрж┐рж░ рж╕ржоржпрж╝ рзк-рзм ржмрж╛рж░ рж╕рзЗржЪ ржжрж┐ржиред рззрзирзж:рзмрзж:рзкрзж NPK ржХрзЗржЬрж┐/рж╣рзЗржХрзНржЯрж░ ржкрзНрж░ржпрж╝рзЛржЧ ржХрж░рзБржиред",
      disease: "рж░рзЛржЧ рж╕ржирж╛ржХрзНрждржХрж░ржгрзЗрж░ ржЬржирзНржп, ржЕржирзБржЧрзНрж░рж╣ ржХрж░рзЗ ржЖржХрзНрж░рж╛ржирзНржд ржЧрж╛ржЫрзЗрж░ ржЕржВрж╢рзЗрж░ рж╕рзНржкрж╖рзНржЯ ржЫржмрж┐ ржЖржкрж▓рзЛржб ржХрж░рзЗ ржЖржорж╛ржжрзЗрж░ рж░рзЛржЧ ржирж┐рж░рзНржгржпрж╝ ржмрзИрж╢рж┐рж╖рзНржЯрзНржп ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржиред",
      weather: "ржЖржмрж╣рж╛ржУржпрж╝рж╛рж░ рждржерзНржп ржЖржорж╛ржжрзЗрж░ ржлрж╕рж▓ рж╕рзБржкрж╛рж░рж┐рж╢рзЗрж░ рж╕рж╛ржерзЗ ржПржХрзАржнрзВрждред рж╕ржарж┐ржХ рж╕рзНржерж╛ржирзАржпрж╝ ржЖржмрж╣рж╛ржУржпрж╝рж╛ ржбрзЗржЯрж╛рж░ ржЬржирзНржп ржЕржмрж╕рзНржерж╛ржи рж╕рзЗржмрж╛ рж╕ржХрзНрж╖ржо ржХрж░рзБржиред",
      market: "ржмрж░рзНрждржорж╛ржи ржмрж╛ржЬрж╛рж░ ржжрж╛ржо ржЕржЮрзНржЪрж▓ ржЕржирзБржпрж╛ржпрж╝рзА ржнрж┐ржирзНржиред ржзрж╛ржи: тВ╣рзирзж-рзирзл/ржХрзЗржЬрж┐, ржЧржо: тВ╣рзирзи-рзирзо/ржХрзЗржЬрж┐, ржЯржорзЗржЯрзЛ: тВ╣рззрзл-рзйрзж/ржХрзЗржЬрж┐ред ржЕржирж▓рж╛ржЗржирзЗ ржерж╛ржХрж▓рзЗ ржжрж╛ржо ржжрзИржирж┐ржХ ржЖржкржбрзЗржЯ рж╣ржпрж╝ред",
      default: "ржЖржорж┐ ржХрзГрж╖рж┐ ржХрзМрж╢рж▓, ржлрж╕рж▓ ржирж┐рж░рзНржмрж╛ржЪржи, ржХрзАржЯржкрждржЩрзНржЧ ржирж┐ржпрж╝ржирзНрждрзНрж░ржг, рж╕рзЗржЪ, рж╕рж╛рж░ ржПржмржВ ржмрж╛ржЬрж╛рж░ рждржерзНржпрзЗ рж╕рж╛рж╣рж╛ржпрзНржп ржХрж░рждрзЗ ржкрж╛рж░рж┐ред ржХрзЛржи ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржмрж┐рж╖ржпрж╝ ржЖржкржирж╛рж░ ржЖржЧрзНрж░рж╣рзЗрж░?"
    },
    te: {
      greeting: "р░ир░ор░╕р▒Нр░Хр░╛р░░р░В! р░Ир░░р▒Лр░Ьр▒Б р░ор▒А р░╡р▒Нр░пр░╡р░╕р░╛р░п р░Ер░╡р░╕р░░р░╛р░▓р░▓р▒Л р░ир▒Зр░ир▒Б р░Ор░▓р░╛ р░╕р░╣р░╛р░пр░В р░Ър▒Зр░пр░Чр░▓р░ир▒Б?",
      rice: "р░╡р░░р░┐ р░╕р░╛р░Чр▒Б р░Ър░┐р░Яр▒Нр░Хр░╛р░▓р▒Б: 2-5 р░╕р▒Жр░ор▒А р░ир▒Ар░Яр░┐ р░╕р▒Нр░ер░╛р░пр░┐р░ир░┐ р░ир░┐р░░р▒Нр░╡р░╣р░┐р░Вр░Ър░Вр░бр░┐, р░╣р▒Жр░Хр▒Нр░Яр░╛р░░р▒Бр░Хр▒Б 25-30 р░Хр░┐р░▓р▒Лр░▓ р░╡р░┐р░др▒Нр░др░ир░╛р░▓р▒Б р░╡р░╛р░бр░Вр░бр░┐, р░ор░░р░┐р░пр▒Б NPK р░Ор░░р▒Бр░╡р▒Бр░▓р░ир▒Б 3 р░нр░╛р░Чр░╛р░▓р▒Бр░Чр░╛ р░╡р▒Зр░пр░Вр░бр░┐. 80% р░Чр░┐р░Вр░Ьр░▓р▒Б р░мр░Вр░Чр░╛р░░р▒Б р░░р░Вр░Чр▒Бр░▓р▒Л р░ор░╛р░░р░┐р░ир░кр▒Нр░кр▒Бр░бр▒Б р░Хр▒Лр░пр░Вр░бр░┐.",
      wheat: "р░Чр▒Лр░зр▒Бр░о р░╡р▒Нр░пр░╡р░╕р░╛р░п р░╕р░▓р░╣р░╛: р░ир░╡р░Вр░мр░░р▒Н-р░бр░┐р░╕р▒Жр░Вр░мр░░р▒НтАМр░▓р▒Л р░╡р░┐р░др▒Нр░др░ир░╛р░▓р▒Б р░╡р▒Зр░пр░Вр░бр░┐, р░╣р▒Жр░Хр▒Нр░Яр░╛р░░р▒Бр░Хр▒Б 100-125 р░Хр░┐р░▓р▒Лр░▓ р░╡р░┐р░др▒Нр░др░ир░╛р░▓р▒Б р░╡р░╛р░бр░Вр░бр░┐, р░кр▒Жр░░р▒Бр░Чр▒Бр░жр░▓ р░Хр░╛р░▓р░Вр░▓р▒Л 4-6 р░╕р░╛р░░р▒Нр░▓р▒Б р░ир▒Ар░░р▒Б р░кр▒Жр░Яр▒Нр░Яр░Вр░бр░┐. 120:60:40 NPK р░Хр░┐р░▓р▒Лр░▓р▒Б/р░╣р▒Жр░Хр▒Нр░Яр░╛р░░р▒Б р░╡р▒Зр░пр░Вр░бр░┐.",
      disease: "р░╡р▒Нр░пр░╛р░зр░┐ р░Чр▒Бр░░р▒Нр░др░┐р░Вр░кр▒Б р░Хр▒Лр░╕р░В, р░жр░пр░Ър▒Зр░╕р░┐ р░кр▒Нр░░р░нр░╛р░╡р░┐р░д р░ор▒Кр░Хр▒Нр░Х р░нр░╛р░Чр░В р░пр▒Кр░Хр▒Нр░Х р░╕р▒Нр░кр░╖р▒Нр░Яр░ор▒Ир░и р░Ър░┐р░др▒Нр░░р░╛р░ир▒Нр░ир░┐ р░Ер░кр▒НтАМр░▓р▒Лр░бр▒Н р░Ър▒Зр░╕р░┐ р░ор░╛ р░╡р▒Нр░пр░╛р░зр░┐ р░ир░┐р░░р▒Нр░зр░╛р░░р░г р░лр▒Ар░Ър░░р▒НтАМр░ир▒Б р░Йр░кр░пр▒Лр░Чр░┐р░Вр░Ър░Вр░бр░┐.",
      weather: "р░╡р░╛р░др░╛р░╡р░░р░г р░╕р░ор░╛р░Ър░╛р░░р░В р░ор░╛ р░кр░Вр░Я р░╕р░┐р░лр░╛р░░р▒Нр░╕р▒Бр░▓р░др▒Л р░Хр░▓р░┐р░╕р░┐ р░Йр░Вр░жр░┐. р░Цр░Ър▒Нр░Ър░┐р░др░ор▒Ир░и р░╕р▒Нр░ер░╛р░ир░┐р░Х р░╡р░╛р░др░╛р░╡р░░р░г р░бр▒Зр░Яр░╛ р░Хр▒Лр░╕р░В р░╕р▒Нр░ер░╛р░и р░╕р▒Зр░╡р░▓р░ир▒Б р░кр▒Нр░░р░╛р░░р░Вр░нр░┐р░Вр░Ър░Вр░бр░┐.",
      market: "р░кр▒Нр░░р░╕р▒Нр░др▒Бр░д р░ор░╛р░░р▒Нр░Хр▒Жр░Яр▒Н р░зр░░р░▓р▒Б р░кр▒Нр░░р░╛р░Вр░др░В р░кр▒Нр░░р░Хр░╛р░░р░В р░ор░╛р░░р▒Бр░др░╛р░пр░┐. р░╡р░░р░┐: тВ╣20-25/р░Хр░┐р░▓р▒Л, р░Чр▒Лр░зр▒Бр░о: тВ╣22-28/р░Хр░┐р░▓р▒Л, р░Яр░ор░╛р░Яр▒Л: тВ╣15-30/р░Хр░┐р░▓р▒Л. р░Жр░ир▒НтАМр░▓р▒Ир░ир▒НтАМр░▓р▒Л р░Йр░ир▒Нр░ир░кр▒Нр░кр▒Бр░бр▒Б р░зр░░р░▓р▒Б р░░р▒Лр░Ьр▒Бр░╡р░╛р░░р▒А р░Ер░кр▒НтАМр░бр▒Зр░Яр▒Н р░Ер░╡р▒Бр░др░╛р░пр░┐.",
      default: "р░ир▒Зр░ир▒Б р░╡р▒Нр░пр░╡р░╕р░╛р░п р░кр░жр▒Нр░зр░др▒Бр░▓р▒Б, р░кр░Вр░Я р░Ор░Вр░кр░┐р░Х, р░Хр▒Ар░Яр░Х р░ир░┐р░пр░Вр░др▒Нр░░р░г, р░ир▒Ар░Яр░┐р░кр░╛р░░р▒Бр░жр░▓, р░Ор░░р▒Бр░╡р▒Бр░▓р▒Б р░ор░░р░┐р░пр▒Б р░ор░╛р░░р▒Нр░Хр▒Жр░Яр▒Н р░╕р░ор░╛р░Ър░╛р░░р░Вр░▓р▒Л р░╕р░╣р░╛р░пр░В р░Ър▒Зр░пр░Чр░▓р░ир▒Б. р░ор▒Ар░Хр▒Б р░П р░ир░┐р░░р▒Нр░жр░┐р░╖р▒Нр░Я р░Ер░Вр░╢р░В р░Жр░╕р░Хр▒Нр░др░┐р░Хр░░р░Вр░Чр░╛ р░Ер░ир░┐р░кр░┐р░╕р▒Нр░др▒Бр░Вр░жр░┐?"
    },
    ta: {
      greeting: "ро╡рогроХрпНроХроорпН! роЗройрпНро▒рпБ роЙроЩрпНроХро│рпН ро╡ро┐ро╡роЪро╛роп родрпЗро╡рпИроХро│ро┐ро▓рпН роиро╛ройрпН роОрокрпНрокроЯро┐ роЙродро╡ роорпБроЯро┐ропрпБроорпН?",
      rice: "роЕро░ро┐роЪро┐ роЪро╛роХрпБрокроЯро┐ роХрпБро▒ро┐рокрпНрокрпБроХро│рпН: 2-5 роЪрпЖроорпА роирпАро░рпН роороЯрпНроЯродрпНродрпИ рокро░ро╛рооро░ро┐роХрпНроХро╡рпБроорпН, ро╣рпЖроХрпНроЯрпЗро░рпБроХрпНроХрпБ 25-30 роХро┐ро▓рпЛ ро╡ро┐родрпИроХро│рпИ рокропройрпНрокроЯрпБродрпНродро╡рпБроорпН, рооро▒рпНро▒рпБроорпН NPK роЙро░родрпНродрпИ 3 рокроХрпБродро┐роХро│ро╛роХ рокропройрпНрокроЯрпБродрпНродро╡рпБроорпН. 80% родро╛ройро┐ропроЩрпНроХро│рпН родроЩрпНроХ роиро┐ро▒рооро╛роХ рооро╛ро▒рпБроорпНрокрпЛродрпБ роЕро▒рпБро╡роЯрпИ роЪрпЖропрпНропро╡рпБроорпН.",
      wheat: "роХрпЛродрпБроорпИ ро╡ро┐ро╡роЪро╛роп роЖро▓рпЛроЪройрпИ: роиро╡роорпНрокро░рпН-роЯро┐роЪроорпНрокро░ро┐ро▓рпН ро╡ро┐родрпИроХрпНроХро╡рпБроорпН, ро╣рпЖроХрпНроЯрпЗро░рпБроХрпНроХрпБ 100-125 роХро┐ро▓рпЛ ро╡ро┐родрпИроХро│рпИ рокропройрпНрокроЯрпБродрпНродро╡рпБроорпН, ро╡ро│ро░рпНроЪрпНроЪро┐ роХро╛ро▓родрпНродро┐ро▓рпН 4-6 роорпБро▒рпИ роирпАро░рпНрокрпНрокро╛роЪройроорпН роЪрпЖропрпНропро╡рпБроорпН. 120:60:40 NPK роХро┐ро▓рпЛ/ро╣рпЖроХрпНроЯрпЗро░рпН рокропройрпНрокроЯрпБродрпНродро╡рпБроорпН.",
      disease: "роирпЛропрпН роХрогрпНроЯро▒ро┐родро▓рпБроХрпНроХрпБ, родропро╡рпБроЪрпЖропрпНродрпБ рокро╛родро┐роХрпНроХрокрпНрокроЯрпНроЯ родро╛ро╡ро░ рокроХрпБродро┐ропро┐ройрпН родрпЖро│ро┐ро╡ро╛рой рокроЯродрпНродрпИ рокродро┐ро╡рпЗро▒рпНро▒ро┐ роОроЩрпНроХро│рпН роирпЛропрпН роХрогрпНроЯро▒ро┐родро▓рпН роЕроорпНроЪродрпНродрпИ рокропройрпНрокроЯрпБродрпНродро╡рпБроорпН.",
      weather: "ро╡ро╛ройро┐ро▓рпИ родроХро╡ро▓рпН роОроЩрпНроХро│рпН рокропро┐ро░рпН рокро░ро┐роирпНродрпБро░рпИроХро│рпБроЯройрпН роТро░рпБроЩрпНроХро┐рогрпИроХрпНроХрокрпНрокроЯрпНроЯрпБро│рпНро│родрпБ. родрпБро▓рпНро▓ро┐ропрооро╛рой роЙро│рпНро│рпВро░рпН ро╡ро╛ройро┐ро▓рпИ родро░ро╡рпБроХрпНроХрпБ роЗроЯроорпН роЪрпЗро╡рпИроХро│рпИ роЗропроХрпНроХро╡рпБроорпН.",
      market: "родро▒рпНрокрпЛродрпИроп роЪроирпНродрпИ ро╡ро┐ро▓рпИроХро│рпН рокроХрпБродро┐ропро┐ройрпН роЕроЯро┐рокрпНрокроЯрпИропро┐ро▓рпН рооро╛ро▒рпБрокроЯрпБроорпН. роЕро░ро┐роЪро┐: тВ╣20-25/роХро┐ро▓рпЛ, роХрпЛродрпБроорпИ: тВ╣22-28/роХро┐ро▓рпЛ, родроХрпНроХро╛ро│ро┐: тВ╣15-30/роХро┐ро▓рпЛ. роЖройрпНро▓рпИройро┐ро▓рпН роЗро░рпБроХрпНроХрпБроорпНрокрпЛродрпБ ро╡ро┐ро▓рпИроХро│рпН родро┐ройроЪро░ро┐ рокрпБродрпБрокрпНрокро┐роХрпНроХрокрпНрокроЯрпБроорпН.",
      default: "роиро╛ройрпН ро╡ро┐ро╡роЪро╛роп роирпБроЯрпНрокроЩрпНроХро│рпН, рокропро┐ро░рпН родрпЗро░рпНро╡рпБ, рокрпВроЪрпНроЪро┐ роХроЯрпНроЯрпБрокрпНрокро╛роЯрпБ, роирпАро░рпНрокрпНрокро╛роЪройроорпН, роЙро░роЩрпНроХро│рпН рооро▒рпНро▒рпБроорпН роЪроирпНродрпИ родроХро╡ро▓рпНроХро│ро┐ро▓рпН роЙродро╡ роорпБроЯро┐ропрпБроорпН. роОроирпНрод роХрпБро▒ро┐рокрпНрокро┐роЯрпНроЯ родро▓рпИрокрпНрокрпБ роЙроЩрпНроХро│рпБроХрпНроХрпБ роЖро░рпНро╡рооро╛роХ роЙро│рпНро│родрпБ?"
    }
  };

  const getResponse = (userMessage: string): string => {
    const message = userMessage.toLowerCase();
    const responses = predefinedResponses[selectedLanguage as keyof typeof predefinedResponses] || predefinedResponses.en;

    if (message.includes('rice') || message.includes('рдЪрд╛рд╡рд▓')) return responses.rice;
    if (message.includes('wheat') || message.includes('рдЧреЗрд╣реВрдВ')) return responses.wheat;
    if (message.includes('disease') || message.includes('рдмреАрдорд╛рд░реА')) return responses.disease;
    if (message.includes('weather') || message.includes('рдореМрд╕рдо')) return responses.weather;
    if (message.includes('price') || message.includes('market') || message.includes('рдХреАрдордд')) return responses.market;
    if (message.includes('hello') || message.includes('hi') || message.includes('рдирдорд╕реНрддреЗ')) return responses.greeting;
    
    return responses.default;
  };

  const sendMessage = async () => {
    if (!inputText.trim()) return;

    const userMessage: Message = {
      id: Date.now().toString(),
      text: inputText,
      sender: 'user',
      timestamp: new Date()
    };

    setMessages(prev => [...prev, userMessage]);
    setInputText('');
    setIsTyping(true);

    // Simulate bot response delay
    setTimeout(() => {
      const botResponse: Message = {
        id: (Date.now() + 1).toString(),
        text: getResponse(inputText),
        sender: 'bot',
        timestamp: new Date()
      };
      setMessages(prev => [...prev, botResponse]);
      setIsTyping(false);
    }, 1500);
  };

  const toggleRecording = () => {
    setIsRecording(!isRecording);
    // In a real app, this would start/stop voice recognition
    if (!isRecording) {
      setTimeout(() => {
        setIsRecording(false);
        setInputText("How do I control pests in my tomato crop?");
      }, 3000);
    }
  };

  const speakText = (text: string) => {
    if ('speechSynthesis' in window) {
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = selectedLanguage === 'hi' ? 'hi-IN' : 'en-US';
      speechSynthesis.speak(utterance);
    }
  };

  const quickQuestions = {
    en: [
      "What crops should I plant this season?",
      "How to control pests naturally?",
      "What is the current market price?",
      "How much water does rice need?",
    ],
    hi: [
      "рдЗрд╕ рд╕реАрдЬрд╝рди рдореЗрдВ рдореБрдЭреЗ рдХреМрди рд╕реА рдлрд╕рд▓ рд▓рдЧрд╛рдиреА рдЪрд╛рд╣рд┐рдП?",
      "рдХреАрдЯреЛрдВ рдХреЛ рдкреНрд░рд╛рдХреГрддрд┐рдХ рд░реВрдк рд╕реЗ рдХреИрд╕реЗ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░реЗрдВ?",
      "рд╡рд░реНрддрдорд╛рди рдмрд╛рдЬрд╛рд░ рдореВрд▓реНрдп рдХреНрдпрд╛ рд╣реИ?",
      "рдЪрд╛рд╡рд▓ рдХреЛ рдХрд┐рддрдиреЗ рдкрд╛рдиреА рдХреА рдЬрд░реВрд░рдд рд╣реЛрддреА рд╣реИ?",
    ],
    mr: [
      "рдпрд╛ рд╣рдВрдЧрд╛рдорд╛рдд рдореА рдХреЛрдгрддреА рдкрд┐рдХреЗ рд▓рд╛рд╡рд╛рд╡реАрдд?",
      "рдХреАрдЯрдХрд╛рдВрдирд╛ рдиреИрд╕рд░реНрдЧрд┐рдХрд░рд┐рддреНрдпрд╛ рдХрд╕реЗ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рд╛рд╡реЗ?",
      "рд╕рдзреНрдпрд╛рдЪреА рдмрд╛рдЬрд╛рд░ рдХрд┐рдВрдордд рдХрд╛рдп рдЖрд╣реЗ?",
      "рддрд╛рдВрджрд│рд╛рд▓рд╛ рдХрд┐рддреА рдкрд╛рдгреНрдпрд╛рдЪреА рдЧрд░рдЬ рдЖрд╣реЗ?",
    ],
    bn: [
      "ржПржЗ ржорзМрж╕рзБржорзЗ ржЖржорж╛рж░ ржХрзЛржи ржлрж╕рж▓ рж░рзЛржкржг ржХрж░рж╛ ржЙржЪрж┐ржд?",
      "ржХрзАржнрж╛ржмрзЗ ржкрзНрж░рж╛ржХрзГрждрж┐ржХржнрж╛ржмрзЗ ржХрзАржЯржкрждржЩрзНржЧ ржирж┐ржпрж╝ржирзНрждрзНрж░ржг ржХрж░ржмрзЗржи?",
      "ржмрж░рзНрждржорж╛ржи ржмрж╛ржЬрж╛рж░ ржжрж╛ржо ржХржд?",
      "ржзрж╛ржирзЗрж░ ржХржд ржкрж╛ржирж┐ ржкрзНрж░ржпрж╝рзЛржЬржи?",
    ],
    te: [
      "р░И р░╕р▒Ар░Ьр░ир▒НтАМр░▓р▒Л р░ир▒Зр░ир▒Б р░П р░кр░Вр░Яр░▓р▒Б р░ир░╛р░Яр░╛р░▓р░┐?",
      "р░╕р░╣р░Ьр░Вр░Чр░╛ р░Хр▒Ар░Яр░Хр░╛р░▓р░ир▒Б р░Ор░▓р░╛ р░ир░┐р░пр░Вр░др▒Нр░░р░┐р░Вр░Ър░╛р░▓р░┐?",
      "р░кр▒Нр░░р░╕р▒Нр░др▒Бр░д р░ор░╛р░░р▒Нр░Хр▒Жр░Яр▒Н р░зр░░ р░Ор░Вр░д?",
      "р░╡р░░р░┐р░Хр░┐ р░Ор░Вр░д р░ир▒Ар░░р▒Б р░Ер░╡р░╕р░░р░В?",
    ],
    ta: [
      "роЗроирпНрод рокро░рпБро╡родрпНродро┐ро▓рпН роиро╛ройрпН роОроирпНрод рокропро┐ро░рпНроХро│рпИ роироЯро╡рпЗрогрпНроЯрпБроорпН?",
      "роЗропро▒рпНроХрпИропро╛роХ рокрпВроЪрпНроЪро┐роХро│рпИ роОрокрпНрокроЯро┐ роХроЯрпНроЯрпБрокрпНрокроЯрпБродрпНродрпБро╡родрпБ?",
      "родро▒рпНрокрпЛродрпИроп роЪроирпНродрпИ ро╡ро┐ро▓рпИ роОройрпНрой?",
      "роЕро░ро┐роЪро┐роХрпНроХрпБ роОро╡рпНро╡ро│ро╡рпБ родрогрпНрогрпАро░рпН родрпЗро╡рпИ?",
    ]
  };

  const questions = quickQuestions[selectedLanguage as keyof typeof quickQuestions] || quickQuestions.en;

  return (
    <div className="max-w-4xl mx-auto p-6 h-screen flex flex-col">
      <h1 className="text-3xl font-bold text-blue-800 mb-4 text-center">
        ЁЯдЦ AI Farming Assistant
      </h1>

      {!isOnline && (
        <div className="bg-yellow-100 border border-yellow-300 rounded-lg p-3 mb-4 text-center">
          <span className="text-yellow-800 text-sm">
            ЁЯУ▒ Offline mode - Using cached responses
          </span>
        </div>
      )}

      {/* Quick Questions */}
      <div className="mb-4">
        <h3 className="text-sm font-medium text-gray-700 mb-2">Quick Questions:</h3>
        <div className="flex flex-wrap gap-2">
          {questions.map((question, index) => (
            <button
              key={index}
              onClick={() => setInputText(question)}
              className="text-xs bg-blue-100 text-blue-800 px-3 py-1 rounded-full hover:bg-blue-200 transition-colors"
            >
              {question}
            </button>
          ))}
        </div>
      </div>

      {/* Messages */}
      <div className="flex-1 bg-white rounded-lg shadow-md overflow-y-auto p-4 mb-4">
        {messages.map((message) => (
          <div
            key={message.id}
            className={flex mb-4 ${message.sender === 'user' ? 'justify-end' : 'justify-start'}}
          >
            <div className={flex max-w-xs lg:max-w-md ${message.sender === 'user' ? 'flex-row-reverse' : 'flex-row'}}>
              <div className={`flex-shrink-0 h-8 w-8 rounded-full flex items-center justify-center ${
                message.sender === 'user' ? 'bg-green-600 ml-2' : 'bg-blue-600 mr-2'
              }`}>
                {message.sender === 'user' ? (
                  <User className="h-4 w-4 text-white" />
                ) : (
                  <Bot className="h-4 w-4 text-white" />
                )}
              </div>
              <div className={`px-4 py-2 rounded-lg ${
                message.sender === 'user' 
                  ? 'bg-green-600 text-white' 
                  : 'bg-gray-100 text-gray-900'
              }`}>
                <p className="text-sm">{message.text}</p>
                {message.sender === 'bot' && (
                  <button
                    onClick={() => speakText(message.text)}
                    className="mt-2 text-xs text-gray-500 hover:text-gray-700 flex items-center"
                  >
                    <Volume2 className="h-3 w-3 mr-1" />
                    Listen
                  </button>
                )}
              </div>
            </div>
          </div>
        ))}
        
        {isTyping && (
          <div className="flex justify-start mb-4">
            <div className="flex">
              <div className="bg-blue-600 rounded-full h-8 w-8 flex items-center justify-center mr-2">
                <Bot className="h-4 w-4 text-white" />
              </div>
              <div className="bg-gray-100 px-4 py-2 rounded-lg">
                <div className="flex space-x-1">
                  <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div>
                  <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{animationDelay: '0.1s'}}></div>
                  <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{animationDelay: '0.2s'}}></div>
                </div>
              </div>
            </div>
          </div>
        )}
        <div ref={messagesEndRef} />
      </div>

      {/* Input Area */}
      <div className="flex items-center space-x-2 bg-white rounded-lg shadow-md p-3">
        <input
          type="text"
          value={inputText}
          onChange={(e) => setInputText(e.target.value)}
          onKeyPress={(e) => e.key === 'Enter' && sendMessage()}
          placeholder={selectedLanguage === 'hi' ? 'рдЕрдкрдирд╛ рд╕рд╡рд╛рд▓ рдкреВрдЫреЗрдВ...' : 'Ask your farming question...'}
          className="flex-1 border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        />
        
        <button
          onClick={toggleRecording}
          className={`p-2 rounded-lg ${
            isRecording 
              ? 'bg-red-600 text-white animate-pulse' 
              : 'bg-gray-200 text-gray-600 hover:bg-gray-300'
          }`}
        >
          {isRecording ? <MicOff className="h-5 w-5" /> : <Mic className="h-5 w-5" />}
        </button>
        
        <button
          onClick={sendMessage}
          disabled={!inputText.trim()}
          className="bg-blue-600 text-white p-2 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed"
        >
          <Send className="h-5 w-5" />
        </button>
      </div>
    </div>
  );
};

export default ChatBot;